Étapes détaillées pour créer une clé USB bootable avec Debian Linux en mode OPAC
L'objectif est de créer une clé USB bootable contenant Debian Linux, configurée pour démarrer automatiquement en mode kiosque, sans nécessiter de connexion de session, et limitant l'accès au navigateur uniquement au site de la médiathèque de Rueil-Malmaison : https://catalogue.mediatheque-rueilmalmaison.fr/.

Prérequis

Matériel nécessaire :


Une clé USB d'au moins 4 Go.
Un ordinateur avec accès à internet pour créer la clé USB.
L'ordinateur cible sur lequel la clé USB sera utilisée.


Logiciels nécessaires :


Image ISO de Debian Linux.
Un outil pour créer une clé USB bootable (Rufus, balenaEtcher, etc.).

Étapes à suivre
1. Téléchargement de l'image ISO de Debian
Rendez-vous sur le site officiel de Debian : https://www.debian.org/CD/live/
Téléchargez l'image ISO "live" de Debian avec l'environnement de bureau léger, par exemple Debian Live with LXDE ou XFCE pour des performances optimales.
Assurez-vous de choisir la version compatible avec l'architecture de votre machine (amd64 pour 64 bits).
2. Création de la clé USB bootable
Sur Windows :
Téléchargez et installez Rufus : https://rufus.ie/
Insérez la clé USB dans votre ordinateur.
Lancez Rufus.
Dans Rufus :
Sélectionnez votre clé USB dans le menu déroulant "Périphérique".
Cliquez sur "Sélection" et choisissez l'image ISO de Debian que vous avez téléchargée.
Laissez les autres paramètres par défaut.
Cliquez sur "Démarrer" pour créer la clé USB bootable.

Sur macOS ou Linux :
Téléchargez et installez balenaEtcher : https://www.balena.io/etcher/
Insérez la clé USB dans votre ordinateur.
Lancez balenaEtcher.
Sélectionnez l'image ISO de Debian.
Choisissez la clé USB comme destination.
Cliquez sur "Flash!" pour créer la clé USB bootable.
3. Configuration initiale de Debian
Insérez la clé USB dans l'ordinateur cible.
Allumez l'ordinateur et accédez au menu de démarrage (généralement en appuyant sur F12, F10, F2 ou Échap lors du démarrage).
Sélectionnez la clé USB comme périphérique de démarrage.
Debian Live devrait se lancer.
Optionnel : Vous pouvez utiliser Debian en mode live ou installer Debian sur le disque dur de l'ordinateur. Pour une utilisation permanente et des performances optimales, il est recommandé d'installer Debian.
4. Installation de Debian (si choisi)
Cliquez sur l'icône "Installer Debian" sur le bureau.
Suivez les instructions à l'écran pour l'installation.
Lorsque vous êtes invité à créer un utilisateur, créez un utilisateur standard (par exemple, "kioskuser") avec un mot de passe simple.
Configurez le clavier, la langue et le fuseau horaire selon vos préférences.
Lors de la sélection des logiciels, choisissez uniquement l'environnement de bureau que vous souhaitez (LXDE ou XFCE).

5. Configuration de l'ouverture de session automatique (autologin)

Pour LXDE avec LightDM :



Ouvrez un terminal.



Éditez le fichier de configuration de LightDM :


sudo nano /etc/lightdm/lightdm.conf


Recherchez et modifiez les lignes suivantes dans la section [Seat:*] :


[Seat:*]
autologin-user=kioskuser
autologin-user-timeout=0


Enregistrez et fermez le fichier (Ctrl + O, puis Ctrl + X).



6. Installation du navigateur et configuration en mode kiosque

Installer Chromium :


sudo apt update
sudo apt install chromium-browser


Créer un script de démarrage automatique du navigateur :



Créez le répertoire autostart s'il n'existe pas :


mkdir -p ~/.config/autostart


Créez un fichier desktop pour lancer Chromium en mode kiosque :


nano ~/.config/autostart/kiosk_chromium.desktop


Ajoutez le contenu suivant :


[Desktop Entry]
Type=Application
Exec=chromium-browser --kiosk --app=https://catalogue.mediatheque-rueilmalmaison.fr/ --incognito --noerrdialogs --disable-translate --no-first-run --disable-infobars
Hidden=false
X-GNOME-Autostart-enabled=true
Name=Kiosk Chromium



Explication des options :


--kiosk : Lance le navigateur en plein écran sans barre d'adresse ni commandes.
--app=URL : Ouvre directement l'URL spécifiée.
--incognito : Ouvre en mode navigation privée.
--noerrdialogs, --disable-translate, --no-first-run, --disable-infobars : Désactivent les dialogues et notifications pour une expérience plus propre.

7. Restriction de l'accès au seul site de la médiathèque
Option 1 : Utiliser un fichier /etc/hosts

Éditer le fichier /etc/hosts :


sudo nano /etc/hosts


Ajoutez les lignes suivantes pour rediriger tous les autres domaines vers localhost :


127.0.0.1    localhost
127.0.0.1    catalogue.mediatheque-rueilmalmaison.fr
0.0.0.0      www.google.com
0.0.0.0      www.youtube.com
# Ajoutez d'autres domaines à bloquer si nécessaire


Note : Cette méthode est limitée et nécessite de bloquer manuellement chaque domaine indésirable.


Option 2 : Configurer le pare-feu avec iptables

Bloquez tout le trafic sortant sauf vers le site de la médiathèque.


# Bloquer tout le trafic sortant
sudo iptables -P OUTPUT DROP

# Autoriser le trafic sortant vers le domaine de la médiathèque
sudo iptables -A OUTPUT -p tcp -d catalogue.mediatheque-rueilmalmaison.fr -j ACCEPT

# Autoriser le trafic nécessaire pour le système (DNS, etc.)
sudo iptables -A OUTPUT -p udp --dport 53 -j ACCEPT
sudo iptables -A OUTPUT -o lo -j ACCEPT


Sauvegarder les règles iptables pour qu'elles persistent au redémarrage :


sudo apt install iptables-persistent
sudo netfilter-persistent save

8. Désactivation des fonctionnalités supplémentaires du système

Supprimer les panels et le menu d'application :


Faites un clic droit sur le panneau, puis sélectionnez "Paramètres du panneau" et désactivez les éléments inutiles.
Vous pouvez également éditer les paramètres pour empêcher l'utilisateur d'accéder aux menus.


Désactiver le gestionnaire de fichiers au clic droit :


Éditez les préférences du bureau pour désactiver le menu contextuel.

9. Configuration de l'extinction automatique

Créer un script d'extinction après une période d'inactivité :



Installez xprintidle pour vérifier le temps d'inactivité :


sudo apt install xprintidle


Créez un script d'extinction automatique :


sudo nano /usr/local/bin/auto_shutdown.sh


Ajoutez le contenu suivant :


#!/bin/bash

while true; do
  idle_time=$(xprintidle)
  if [ $idle_time -gt 900000 ]; then  # 900000 millisecondes = 15 minutes
    sudo shutdown -h now
  fi
  sleep 60
done


Rendre le script exécutable :


sudo chmod +x /usr/local/bin/auto_shutdown.sh


Lancer le script au démarrage :



Créez un fichier desktop dans autostart :


nano ~/.config/autostart/auto_shutdown.desktop


Ajoutez le contenu suivant :


[Desktop Entry]
Type=Application
Exec=/usr/local/bin/auto_shutdown.sh
Hidden=false
X-GNOME-Autostart-enabled=true
Name=Auto Shutdown



10. Finalisation et test

Redémarrez le système pour appliquer toutes les modifications :


sudo reboot


Vérifiez que :


Le système démarre sans demander de connexion.
Le navigateur s'ouvre automatiquement en affichant uniquement le site de la médiathèque.
L'accès à d'autres sites est effectivement bloqué.
Le système s'éteint après la période d'inactivité définie.

Conseils supplémentaires

Sécurité :



Pour empêcher l'accès aux consoles virtuelles (Ctrl+Alt+F1, etc.), vous pouvez désactiver ces raccourcis.


sudo nano /etc/default/keyboard


Ajoutez ou modifiez la ligne suivante :


XKBOPTIONS="nocaps"



Désactivez les raccourcis clavier indésirables dans les paramètres du gestionnaire de fenêtres.




Maintenance :


Pour effectuer des mises à jour ou des modifications, vous devrez peut-être réactiver temporairement certaines fonctions ou accéder via SSH.


Sauvegarde :


Il peut être judicieux de cloner la configuration une fois qu'elle fonctionne, pour pouvoir la déployer facilement sur d'autres machines.

Conclusion
En suivant ces étapes, vous aurez une clé USB bootable avec Debian Linux configurée pour fonctionner en mode OPAC, offrant un accès restreint uniquement au site spécifié, sans nécessiter d'intervention de l'utilisateur pour démarrer ou arrêter le système. Cette configuration est idéale pour des postes de consultation en bibliothèque ou en médiathèque.