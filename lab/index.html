<!doctype html>
<html lang="fr">
<head>
	<meta charset="utf-8">
	<title>Dungeon Maze</title>
	<link rel="icon" type="image/png" href="https://em-content.zobj.net/thumbs/120/whatsapp/352/classical-building_1f3db-fe0f.png"/>
	<style>
		html,body{
			height:100%;
			margin:0;
		}
		body{
			background-color:#1f1911;overflow:hidden;
		}
		svg{
			border:1px solid #000;
		}
	</style>
</head>
<body>
	<svg width="100%" height="100%" viewBox="0 0 500 500">
		<image xlink:href="room.png"width="500" height="500"/>
		<image xlink:href="void.png"width="500" height="500" id="wall_north"/>
		<image xlink:href="void.png"width="500" height="500" id="wall_south"/>
		<image xlink:href="void.png"width="500" height="500" id="wall_east"/>
		<image xlink:href="void.png"width="500" height="500" id="wall_west"/>
		<g id="player" transform="translate(250,250)" opacity="0.6">
			<ellipse cx="7" cy="30" rx="15" ry="5" fill="#000" opacity="0.4"/>
			<image xlink:href="ghost.png" width="50" height="50" x="-25" y="-25"/>
		</g>
	</svg>
<script>
	var lab1=[
		1,1,1,1,1,1,1,
		1,0,0,0,1,0,1,
		1,0,1,0,1,0,1,
		1,0,1,0,1,0,1,
		1,0,1,0,1,0,1,
		1,0,1,0,0,0,1,
		1,1,1,1,1,1,1
	];
	var lab=lab1;
	var lab_width=7;
	//var lab_height;
	var pos=12;
	var px=250;
	var py=250;
	var px_min,px_max,py_min,py_max;

	var wall_north=document.getElementById("wall_north");
	var wall_south=document.getElementById("wall_south");
	var wall_east=document.getElementById("wall_east");
	var wall_west=document.getElementById("wall_west");
	var player=document.getElementById("player");

	function draw_room(lab,lab_width,pos,px,py){
		//begin initialization
		wall_north.setAttribute("xlink:href","void.png");
		wall_south.setAttribute("xlink:href","void.png");
		wall_east.setAttribute("xlink:href","void.png");
		wall_west.setAttribute("xlink:href","void.png");
		px_min=50;px_max=450;py_min=50;py_max=450;
		//end initialization

		if(lab[pos-lab_width]==0){wall_north.setAttribute("xlink:href","path_north.png");py_min=0;}
		if(lab[pos+lab_width]==0){wall_south.setAttribute("xlink:href","path_south.png");py_max=500;}
		if(lab[pos+1]==0){wall_east.setAttribute("xlink:href","path_east.png");px_max=500;}
		if(lab[pos-1]==0){wall_west.setAttribute("xlink:href","path_west.png");px_min=0;}
		player.setAttribute("transform","translate("+px+","+py+")");
	}

	draw_room(lab1,7,12,250,250);

	function move(){
		var velY=0,
			velX=0,
			speed=4,
			friction=0.9,
			keys=[];

		function update(){

			requestAnimationFrame(update);

			if (keys[90]){if(velY> -speed){velY--;}}
			if (keys[83]){if(velY<speed){velY++;}}
			if (keys[68]){if(velX<speed){velX++;}}
			if (keys[81]){if(velX> -speed){velX--;}}

			velY*=friction;
			py+=Math.round(velY);
			velX*=friction;
			px+=Math.round(velX);

			if(px>px_max){
				if(px_max==500){px=50;pos++;draw_room(lab,lab_width,pos,px,py);console.log(pos);}
			}else if(px<px_min){
				if(px_min==0){px=450;pos--;draw_room(lab,lab_width,pos,px,py);console.log(pos);}
			}
			if(py>py_max){
				if(py_max==500){py=50;pos=pos+lab_width;draw_room(lab,lab_width,pos,px,py);console.log(pos);}
			}else if(py<py_min){
				if(py_min==0){py=450;pos=pos-lab_width;draw_room(lab,lab_width,pos,px,py);console.log(pos);}
			}

			player.setAttribute("transform","translate("+px+","+py+")");

		}
		update();

		document.body.addEventListener("keydown",function(e){
			keys[e.keyCode]=true;
		});

		document.body.addEventListener("keyup",function(e){
			keys[e.keyCode]=false;
		});
	}

	move();

</script>
</body>
</html>